# OS Detection
case "$(uname -s)" in
    Darwin) _OS="mac" ;;
    Linux)  _OS="linux" ;;
esac

# General Aliases
alias rld='source ~/.zshrc'  # Reload ZSH configuration
alias please='sudo $(fc -ln -1)'  # Redo last command with sudo
alias ff='find . -name'  # Find files; use asterisks
alias fwrd='grep -rnwi . -e'  # Recursive word search in files with line numbers
alias ftxt='grep -rni . -e'   # Recursive text search in files with line numbers
alias fpy='find . -name "*.py" | xargs grep --color'  # Find and grep Python files
alias grep='grep --color=auto'  # Grep with color
alias hgrep='history | grep -v grep | grep '  # Search command history
alias psgrep='ps aux | grep -v grep | grep '  # Search processes
if [[ $_OS == "mac" ]]; then
    alias ll='ls -GlAFh'
    alias lls='ls -GlAFhS'
else
    alias ll='ls --color=auto -lAFh'
    alias lls='ls --color=auto -lAFhS'
fi
alias showpath='echo $PATH | tr ":" "\n"'  # Show PATH with each directory on a new line

# GPU Monitoring (requires gpustat and/or nvidia-smi)
alias wgpu='watch -d -n 0.5 gpustat'  # GPU stats (requires gpustat)
alias ns='watch -d -n 0.5 nvidia-htop.py'  # Alternative GPU monitoring

# Environment Variable Check
alias ckenv='printenv | grep -i'  # Search environment variables
alias ckal='alias | grep -i'  # Check aliases

# Enhanced cat with syntax highlighting
alias ccat='pygmentize -O style=monokai -f console256 -g'
alias c='clear'  # Clear terminal screen

# PATH Viewing
alias path='echo -e ${PATH//:/\\n}'  # Display each PATH entry on a new line

# Tmux Aliases
alias tmn='tmux new-session'  # Start a new tmux session
alias tmk='tmux kill-session -t'  # Kill a tmux session
alias tma='tmux a -t'  # Attach to a tmux session
alias tm='tmux ls'  # List all tmux sessions

# Python and Related
alias ipy='ipython'  # IPython shortcut
alias ca='conda activate'  # Activate a conda environment
alias nb='jupyter notebook'  # Start Jupyter Notebook
alias upip='uv pip'
alias pie='pip install -e .'  # Install package in editable mode

[[ $_OS == "mac" ]] && alias md5sum='gmd5sum'

# Shortcuts
alias t='tail -v'
alias mkdir='mkdir -pv'  # Auto-create parent directories
alias pu='popd'
alias pd='pushd'

# File Navigation
alias cdh='cd ~/git'  # Go to the git directory

# Git Aliases
alias gs='git status'  # Show git status

# Make zoxide use j
alias j='z'
alias ji='zi'

alias cv='claude' # with vim keybindings
alias cvd='claude --dangerously-skip-permissions'
alias cvr='claude --resume'

# Helper Functions
function cheat() {
    curl cht.sh/$1  # Fetch cheat sheet from cht.sh
}

# Extract various compressed file types
function extract() {
    if [ -f "$1" ]; then
        case $1 in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       command -v unrar >/dev/null && unrar e "$1" || echo "Install unrar to handle .rar files" ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        command -v 7z >/dev/null && 7z x "$1" || echo "Install 7z to handle .7z files" ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# General Exports
export DATA="$HOME/data"
export MODELS="$HOME/models"
export FZF_DEFAULT_OPTS="--extended"
export DEFAULT_CONDA_ENVIRONMENT="py314"

# History Settings
export HISTSIZE=1000000
export HISTFILESIZE=1000000000
export HISTCONTROL=ignoredups:erasedups  # No duplicate entries in history

# Source external files if they exist
include() {
    [[ -f "$1" ]] && source "$1"
}

# Allow sublime text to be opened from command line with `subl`
[[ $_OS == "mac" ]] && export PATH="/Applications/Sublime Text.app/Contents/SharedSupport/bin:$PATH"

[[ $_OS == "mac" ]] && export PATH="$PATH:$HOME/.nvm/versions/node/v20.15.0/bin"


# Additional includes for ZSH plugins and utilities
if [[ $_OS == "mac" ]]; then
    include /usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
else
    include /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
fi

# Homebrew (macOS)
if [[ $_OS == "mac" ]] && [[ -d "${HOMEBREW_PREFIX:-/opt/homebrew}" ]]; then
    eval "$("${HOMEBREW_PREFIX:-/opt/homebrew}/bin/brew" shellenv)"
fi

include "$HOME/.credentials" # Add passwords and other credentials
include "$HOME/.work_profile" # Add other work-specific modifications

include "$HOME/.cargo/env"

# Added by LM Studio CLI (lms)
export PATH="$PATH:$HOME/.lmstudio/bin"

# Word navigation (zsh only)
if [[ -n "$ZSH_VERSION" ]]; then
    bindkey "\e\e[D" backward-word
    bindkey "\e\e[C" forward-word
fi
